<!-- Dashboard Header Section -->
<div class="dashboard-header">
  <div class="welcome-section" style="background: linear-gradient(135deg, rgba(245, 158, 11, 0.1), rgba(139, 92, 246, 0.1)); border-radius: 1rem; padding: 2rem; margin-bottom: 2rem; border: 1px solid rgba(255, 255, 255, 0.1);">
    <h1 style="font-size: 2.5rem; font-weight: bold; margin-bottom: 0.5rem; background: linear-gradient(135deg, #fbbf24, #8b5cf6); -webkit-background-clip: text; -webkit-text-fill-color: transparent;">
      Bonjour <%= current_user&.first_name || 'Admin' %> !
    </h1>
    <p style="color: #9ca3af; font-size: 1.125rem;">
      Tableau de bord CinéRoom - <%= Date.current.strftime('%d %B %Y') %>
    </p>

    <!-- Quick Action Buttons -->
    <div style="margin-top: 1.5rem;">
      <%= link_to "Nouveau Film", admin_movies_path, class: "button",
          style: "margin-right: 1rem; background: linear-gradient(135deg, #f59e0b, #d97706); color: white; padding: 0.75rem 1.5rem; border-radius: 0.75rem; text-decoration: none;" %>
      <%= link_to "Nouvel Événement", admin_events_path, class: "button",
          style: "background: rgba(255, 255, 255, 0.1); color: white; padding: 0.75rem 1.5rem; border-radius: 0.75rem; text-decoration: none;" %>
    </div>
  </div>
</div>

<!-- Key Metrics Section -->
<div class="metrics-section">
  <h2 style="font-size: 1.5rem; font-weight: bold; margin-bottom: 1.5rem; color: #f59e0b;">
    Métriques Clés
  </h2>

  <div style="display: grid; grid-template-columns: repeat(auto-fit, minmax(250px, 1fr)); gap: 1.5rem; margin-bottom: 2rem;">

    <!-- Revenue Metric Card -->
    <div class="metric-card" style="background: rgba(255, 255, 255, 0.02); border: 1px solid rgba(255, 255, 255, 0.1); border-radius: 1rem; padding: 1.5rem; transition: all 0.3s ease;">
      <div style="display: flex; align-items: center; justify-content: space-between; margin-bottom: 1rem;">
        <div style="width: 3rem; height: 3rem; background: rgba(245, 158, 11, 0.1); border-radius: 0.75rem; display: flex; align-items: center; justify-content: center;">
          <i class="fas fa-euro-sign" style="color: #f59e0b; font-size: 1.25rem;"></i>
        </div>
      </div>

      <% revenue_stats = controller.send(:calculate_revenue_stats) %>
      <div style="font-size: 2rem; font-weight: bold; background: linear-gradient(135deg, #fbbf24, #8b5cf6); -webkit-background-clip: text; -webkit-text-fill-color: transparent; margin-bottom: 0.5rem;">
        <%= number_to_currency(revenue_stats[:total_revenue]) %>
      </div>
      <div style="color: #9ca3af; font-size: 0.875rem;">Revenus Total</div>
      <div style="color: #6b7280; font-size: 0.75rem; margin-top: 0.25rem;">
        <%= number_to_currency(revenue_stats[:monthly_revenue]) %> ce mois
      </div>
    </div>

    <!-- Active Events Metric Card -->
    <div class="metric-card" style="background: rgba(255, 255, 255, 0.02); border: 1px solid rgba(255, 255, 255, 0.1); border-radius: 1rem; padding: 1.5rem;">
      <div style="display: flex; align-items: center; margin-bottom: 1rem;">
        <div style="width: 3rem; height: 3rem; background: rgba(37, 99, 235, 0.1); border-radius: 0.75rem; display: flex; align-items: center; justify-content: center;">
          <i class="fas fa-calendar-alt" style="color: #2563eb; font-size: 1.25rem;"></i>
        </div>
      </div>

      <% event_stats = controller.send(:calculate_event_stats) %>
      <div style="font-size: 2rem; font-weight: bold; color: #2563eb; margin-bottom: 0.5rem;">
        <%= event_stats[:upcoming_events] %>
      </div>
      <div style="color: #9ca3af; font-size: 0.875rem;">Événements Actifs</div>
      <div style="color: #6b7280; font-size: 0.75rem; margin-top: 0.25rem;">
        <%= event_stats[:sold_out_events] %> complets
      </div>
    </div>

    <!-- Users Metric Card -->
    <div class="metric-card" style="background: rgba(255, 255, 255, 0.02); border: 1px solid rgba(255, 255, 255, 0.1); border-radius: 1rem; padding: 1.5rem;">
      <div style="display: flex; align-items: center; margin-bottom: 1rem;">
        <div style="width: 3rem; height: 3rem; background: rgba(34, 197, 94, 0.1); border-radius: 0.75rem; display: flex; align-items: center; justify-content: center;">
          <i class="fas fa-users" style="color: #22c55e; font-size: 1.25rem;"></i>
        </div>
      </div>

      <% user_stats = controller.send(:calculate_user_stats) %>
      <div style="font-size: 2rem; font-weight: bold; color: #22c55e; margin-bottom: 0.5rem;">
        <%= user_stats[:total_users] %>
      </div>
      <div style="color: #9ca3af; font-size: 0.875rem;">Utilisateurs Total</div>
      <div style="color: #6b7280; font-size: 0.75rem; margin-top: 0.25rem;">
        <%= user_stats[:active_participants] %> actifs
      </div>
    </div>

    <!-- Satisfaction Metric Card -->
    <div class="metric-card" style="background: rgba(255, 255, 255, 0.02); border: 1px solid rgba(255, 255, 255, 0.1); border-radius: 1rem; padding: 1.5rem;">
      <div style="display: flex; align-items: center; margin-bottom: 1rem;">
        <div style="width: 3rem; height: 3rem; background: rgba(245, 158, 11, 0.1); border-radius: 0.75rem; display: flex; align-items: center; justify-content: center;">
          <i class="fas fa-star" style="color: #f59e0b; font-size: 1.25rem;"></i>
        </div>
      </div>

      <% avg_rating = Review.average(:rating) || 0 %>
      <div style="font-size: 2rem; font-weight: bold; color: #f59e0b; margin-bottom: 0.5rem;">
        <%= avg_rating.round(1) %>/5
      </div>
      <div style="color: #9ca3af; font-size: 0.875rem;">Satisfaction</div>
      <div style="color: #6b7280; font-size: 0.75rem; margin-top: 0.25rem;">
        <%= Review.count %> avis
      </div>
    </div>
  </div>
</div>

<!-- Management Section with Pending Movies and Recent Activity -->
<div class="management-section">
  <div style="display: grid; grid-template-columns: 1fr 1fr; gap: 2rem; margin-bottom: 2rem;">

    <!-- Pending Movies Panel -->
    <div class="panel">
      <h3 style="color: #f59e0b; margin-bottom: 1rem;">Films en Attente de Validation</h3>

      <% pending_movies = Movie.where(validation_status: :pending).limit(5) %>
      <% if pending_movies.any? %>
        <div style="space-y: 0.75rem;">
          <% pending_movies.each do |movie| %>
            <div style="display: flex; align-items: center; justify-content: space-between; padding: 1rem; background: rgba(255, 255, 255, 0.05); border-radius: 0.75rem; margin-bottom: 0.75rem;">
              <!-- Movie Info -->
              <div>
                <div style="font-weight: 600; color: white; margin-bottom: 0.25rem;">
                  <%= movie.title %>
                </div>
                <div style="font-size: 0.875rem; color: #9ca3af;">
                  <%= movie.director %> • <%= movie.year %>
                </div>
                <div style="font-size: 0.75rem; color: #6b7280;">
                  Par <%= movie.user&.full_name || 'Créateur inconnu' %>
                </div>
              </div>

              <!-- Action Buttons -->
              <div style="display: flex; gap: 0.5rem;">
                <%= link_to "Voir", admin_movie_path(movie), class: "button",
                    style: "padding: 0.25rem 0.75rem; background: rgba(37, 99, 235, 0.2); color: #3b82f6; border-radius: 0.5rem; text-decoration: none; font-size: 0.875rem;" %>
              </div>
            </div>
          <% end %>
        </div>

        <div style="margin-top: 1rem; text-align: center;">
          <%= link_to "Voir tous les films en attente",
              admin_movies_path + "?q[validation_status_eq]=pending",
              style: "color: #f59e0b; text-decoration: none;" %>
        </div>
      <% else %>
        <div style="text-align: center; padding: 2rem; color: #9ca3af;">
          <i class="fas fa-check-circle" style="font-size: 3rem; color: #22c55e; margin-bottom: 1rem; display: block;"></i>
          <div>Aucun film en attente de validation</div>
        </div>
      <% end %>
    </div>

    <!-- Recent Activity Panel -->
    <div class="panel">
      <h3 style="color: #2563eb; margin-bottom: 1rem;">Activité Récente</h3>

      <div style="space-y: 1rem;">
        <!-- Recent Participations -->
        <% Participation.includes(:user, :event).order(created_at: :desc).limit(3).each do |participation| %>
          <div style="display: flex; align-items: center; gap: 1rem; padding: 0.75rem; background: rgba(255, 255, 255, 0.03); border-radius: 0.5rem; margin-bottom: 0.75rem;">
            <div style="width: 2.5rem; height: 2.5rem; background: rgba(245, 158, 11, 0.2); border-radius: 0.5rem; display: flex; align-items: center; justify-content: center;">
              <i class="fas fa-ticket-alt" style="color: #f59e0b; font-size: 0.875rem;"></i>
            </div>

            <div style="flex: 1;">
              <div style="font-size: 0.875rem; font-weight: 500; color: white; margin-bottom: 0.25rem;">
                Nouvelle réservation
              </div>
              <div style="font-size: 0.75rem; color: #9ca3af;">
                <%= participation.user&.full_name || 'Utilisateur' %> • <%= participation.event&.title || 'Événement' %>
              </div>
            </div>

            <div style="font-size: 0.75rem; color: #6b7280;">
              <%= time_ago_in_words(participation.created_at) %>
            </div>
          </div>
        <% end %>

        <!-- Recent Movies -->
        <% Movie.includes(:user).order(created_at: :desc).limit(2).each do |movie| %>
          <div style="display: flex; align-items: center; gap: 1rem; padding: 0.75rem; background: rgba(255, 255, 255, 0.03); border-radius: 0.5rem; margin-bottom: 0.75rem;">
            <div style="width: 2.5rem; height: 2.5rem; background: rgba(37, 99, 235, 0.2); border-radius: 0.5rem; display: flex; align-items: center; justify-content: center;">
              <i class="fas fa-film" style="color: #3b82f6; font-size: 0.875rem;"></i>
            </div>

            <div style="flex: 1;">
              <div style="font-size: 0.875rem; font-weight: 500; color: white; margin-bottom: 0.25rem;">
                Nouveau film ajouté
              </div>
              <div style="font-size: 0.75rem; color: #9ca3af;">
                "<%= movie.title %>" par <%= movie.user&.full_name || 'Créateur' %>
              </div>
            </div>

            <div style="font-size: 0.75rem; color: #6b7280;">
              <%= time_ago_in_words(movie.created_at) %>
            </div>
          </div>
        <% end %>
      </div>
    </div>
  </div>
</div>

<!-- Quick Actions Section -->
<div class="quick-actions">
  <h3 style="color: #f59e0b; margin-bottom: 1.5rem; font-size: 1.25rem;">Actions Rapides</h3>

  <div style="display: grid; grid-template-columns: repeat(auto-fit, minmax(200px, 1fr)); gap: 1rem; margin-bottom: 2rem;">

    <!-- Movies Management Action -->
    <%= link_to admin_movies_path, style: "padding: 1rem; background: rgba(255, 255, 255, 0.03); border: 1px solid rgba(255, 255, 255, 0.08); border-radius: 1rem; text-decoration: none; color: white; transition: all 0.3s ease; display: block;" do %>
      <div style="display: flex; align-items: center; gap: 0.75rem;">
        <div style="width: 3rem; height: 3rem; background: rgba(245, 158, 11, 0.2); border-radius: 0.75rem; display: flex; align-items: center; justify-content: center;">
          <i class="fas fa-film" style="color: #f59e0b;"></i>
        </div>
        <div>
          <div style="font-weight: 600; margin-bottom: 0.25rem;">Gérer Films</div>
          <div style="font-size: 0.875rem; color: #9ca3af;">
            <%= Movie.where(validation_status: :pending).count %> en attente
          </div>
        </div>
      </div>
    <% end %>

    <!-- Events Management Action -->
    <%= link_to admin_events_path, style: "padding: 1rem; background: rgba(255, 255, 255, 0.03); border: 1px solid rgba(255, 255, 255, 0.08); border-radius: 1rem; text-decoration: none; color: white; transition: all 0.3s ease; display: block;" do %>
      <div style="display: flex; align-items: center; gap: 0.75rem;">
        <div style="width: 3rem; height: 3rem; background: rgba(37, 99, 235, 0.2); border-radius: 0.75rem; display: flex; align-items: center; justify-content: center;">
          <i class="fas fa-calendar-alt" style="color: #2563eb;"></i>
        </div>
        <div>
          <div style="font-weight: 600; margin-bottom: 0.25rem;">Événements</div>
          <div style="font-size: 0.875rem; color: #9ca3af;">
            <%= Event.where(status: :upcoming).count %> à venir
          </div>
        </div>
      </div>
    <% end %>

    <!-- Users Management Action -->
    <%= link_to admin_users_path, style: "padding: 1rem; background: rgba(255, 255, 255, 0.03); border: 1px solid rgba(255, 255, 255, 0.08); border-radius: 1rem; text-decoration: none; color: white; transition: all 0.3s ease; display: block;" do %>
      <div style="display: flex; align-items: center; gap: 0.75rem;">
        <div style="width: 3rem; height: 3rem; background: rgba(34, 197, 94, 0.2); border-radius: 0.75rem; display: flex; align-items: center; justify-content: center;">
          <i class="fas fa-users" style="color: #22c55e;"></i>
        </div>
        <div>
          <div style="font-weight: 600; margin-bottom: 0.25rem;">Utilisateurs</div>
          <div style="font-size: 0.875rem; color: #9ca3af;">
            <%= User.count %> total
          </div>
        </div>
      </div>
    <% end %>

    <!-- Participations Management Action -->
    <%= link_to admin_participations_path, style: "padding: 1rem; background: rgba(255, 255, 255, 0.03); border: 1px solid rgba(255, 255, 255, 0.08); border-radius: 1rem; text-decoration: none; color: white; transition: all 0.3s ease; display: block;" do %>
      <div style="display: flex; align-items: center; gap: 0.75rem;">
        <div style="width: 3rem; height: 3rem; background: rgba(245, 158, 11, 0.2); border-radius: 0.75rem; display: flex; align-items: center; justify-content: center;">
          <i class="fas fa-ticket-alt" style="color: #f59e0b;"></i>
        </div>
        <div>
          <div style="font-weight: 600; margin-bottom: 0.25rem;">Réservations</div>
          <div style="font-size: 0.875rem; color
