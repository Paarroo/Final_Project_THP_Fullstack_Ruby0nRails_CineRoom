<div
  class="admin-dashboard min-h-screen bg-dark-400 text-white"
  data-controller="admin-dashboard admin-flash"
  data-admin-dashboard-refresh-interval-value="30000"
  data-admin-dashboard-auto-refresh-value="true"
>
  <!-- Dashboard Header -->
  <section class="dashboard-header py-8">
    <div class="container-app">
      <div class="glass-effect rounded-3xl p-8">
        <div class="flex flex-col lg:flex-row lg:items-center lg:justify-between">
          <div>
            <h1 class="text-4xl lg:text-6xl font-bold mb-4">
              Bonjour <span class="gradient-text"><%= current_user&.first_name || 'Admin' %></span> !
            </h1>
            <p class="text-xl text-gray-400">
              Tableau de bord CinéRoom - <%= Date.current.strftime("%d %B %Y") %>
            </p>
            <div class="flex items-center mt-4 text-sm text-gray-400">
              <div class="w-2 h-2 bg-green-400 rounded-full animate-pulse mr-2"></div>
              Système opérationnel • Dernière mise à jour:
              <span data-admin-dashboard-target="lastUpdated"><%= Time.current.strftime("%H:%M") %></span>
            </div>
          </div>

          <div class="mt-6 lg:mt-0 flex flex-col sm:flex-row gap-4">
            <%= link_to "/admin/movies",
                class: "btn-primary" do %>
              <i class="fas fa-plus mr-2"></i>Nouveau Film
            <% end %>

            <%= link_to "/admin/events",
                class: "btn-secondary" do %>
              <i class="fas fa-calendar-plus mr-2"></i>Nouvel Événement
            <% end %>
          </div>
        </div>
      </div>
    </div>
  </section>

  <!-- Key Metrics -->
  <%= render 'metrics_cards', metrics: @metrics %>

  <!-- Charts Section -->
  <%= render 'charts_section', revenue_data: @revenue_chart_data, events_data: @events_chart_data %>

  <!-- Management Tables -->
  <section class="management-section py-8">
    <div class="container-app">
      <div class="grid grid-cols-1 xl:grid-cols-2 gap-8">
        <%= render 'pending_movies', movies: @pending_movies %>
        <%= render 'recent_activity', activities: @recent_activities %>
      </div>
    </div>
  </section>

  <!-- Quick Actions -->
  <%= render 'quick_actions', stats: @quick_stats %>

  <!-- System Status -->
  <section class="system-status py-8">
    <div class="container-app">
      <div class="glass-effect rounded-3xl p-6">
        <div class="flex flex-col lg:flex-row lg:items-center lg:justify-between">
          <div class="flex items-center space-x-6">
            <div class="flex items-center space-x-2">
              <div class="w-3 h-3 bg-green-400 rounded-full animate-pulse"></div>
              <span class="text-white font-medium">Système opérationnel</span>
            </div>

            <div class="flex items-center space-x-2">
              <div class="w-3 h-3 bg-blue-400 rounded-full"></div>
              <span class="text-gray-400">Base de données: OK</span>
            </div>

            <div class="flex items-center space-x-2">
              <div class="w-3 h-3 bg-yellow-400 rounded-full"></div>
              <span class="text-gray-400">Serveur: <%= Rails.env.capitalize %></span>
            </div>
          </div>

          <div class="mt-4 lg:mt-0">
            <button
              class="btn-secondary"
              data-action="click->admin-dashboard#refreshDashboard"
              data-admin-dashboard-target="refreshButton"
            >
              <i class="fas fa-sync-alt mr-2"></i>Actualiser
            </button>
          </div>
        </div>

        <!-- Performance Indicators -->
        <div class="mt-6 grid grid-cols-1 md:grid-cols-3 gap-4">
          <%
            total_capacity = Event.sum(:max_capacity)
            total_bookings = Participation.where(status: :confirmed).sum(:seats)
            occupancy_rate = total_capacity > 0 ? ((total_bookings.to_f / total_capacity) * 100).round(1) : 0
          %>

          <div class="bg-white/5 rounded-xl p-4">
            <div class="flex items-center justify-between">
              <span class="text-gray-400">Taux d'occupation</span>
              <span class="text-green-400 font-bold"><%= occupancy_rate %>%</span>
            </div>
            <div class="w-full bg-white/10 rounded-full h-2 mt-2">
              <div
                class="bg-gradient-to-r from-green-500 to-emerald-600 h-2 rounded-full transition-all duration-500"
                style="width: <%= occupancy_rate %>%"
              ></div>
            </div>
          </div>

          <%
            confirmed_count = Participation.where(status: :confirmed).count
            total_count = Participation.count
            conversion_rate = total_count > 0 ? ((confirmed_count.to_f / total_count) * 100).round(1) : 0
          %>

          <div class="bg-white/5 rounded-xl p-4">
            <div class="flex items-center justify-between">
              <span class="text-gray-400">Taux de conversion</span>
              <span class="text-blue-400 font-bold"><%= conversion_rate %>%</span>
            </div>
            <div class="w-full bg-white/10 rounded-full h-2 mt-2">
              <div
                class="bg-gradient-to-r from-blue-500 to-cyan-600 h-2 rounded-full transition-all duration-500"
                style="width: <%= conversion_rate %>%"
              ></div>
            </div>
          </div>

          <%
            approved_count = Movie.where(validation_status: :approved).count
            movie_total = Movie.count
            validation_rate = movie_total > 0 ? ((approved_count.to_f / movie_total) * 100).round(1) : 0
          %>

          <div class="bg-white/5 rounded-xl p-4">
            <div class="flex items-center justify-between">
              <span class="text-gray-400">Validation films</span>
              <span class="text-yellow-400 font-bold"><%= validation_rate %>%</span>
            </div>
            <div class="w-full bg-white/10 rounded-full h-2 mt-2">
              <div
                class="bg-gradient-to-r from-yellow-500 to-orange-600 h-2 rounded-full transition-all duration-500"
                style="width: <%= validation_rate %>%"
              ></div>
            </div>
          </div>
        </div>
      </div>
    </div>
  </section>
</div>
