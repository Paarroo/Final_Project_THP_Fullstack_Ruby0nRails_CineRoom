<%= render 'admin/dashboard/navbar' %>

<div class="admin-dashboard min-h-screen bg-dark-400">
  <!-- Breadcrumb Navigation -->
  <div class="breadcrumb-section pt-20 pb-4">
    <div class="container-app">
      <nav class="flex items-center space-x-2 text-sm">
        <%= link_to admin_dashboard_index_path, class: "text-gray-400 hover:text-primary transition-colors" do %>
          <i class="fas fa-home mr-1"></i>Dashboard
        <% end %>
        <i class="fas fa-chevron-right text-gray-600"></i>
        <%= link_to admin_events_path, class: "text-gray-400 hover:text-primary transition-colors" do %>
          Événements
        <% end %>
        <i class="fas fa-chevron-right text-gray-600"></i>
        <%= link_to admin_event_path(@event), class: "text-gray-400 hover:text-primary transition-colors" do %>
          <%= @event.title %>
        <% end %>
        <i class="fas fa-chevron-right text-gray-600"></i>
        <span class="text-white">Modifier</span>
      </nav>
    </div>
  </div>

  <!-- Edit Form Header -->
  <section class="form-header py-8">
    <div class="container-app">
      <div class="glass-effect rounded-3xl p-8">
        <div class="text-center mb-8">
          <h1 class="text-4xl lg:text-5xl font-bold mb-3 gradient-text">
            <i class="fas fa-edit mr-4"></i>
            Modifier l'événement
          </h1>
          <p class="text-xl text-gray-300 mb-2">
            Modification : <%= @event.title %>
          </p>
          <p class="text-gray-400 text-base">
            ID: #<%= @event.id %> • Créé le <%= @event.created_at.strftime("%d/%m/%Y") %>
          </p>
        </div>

        <!-- Current Status Display -->
        <div class="text-center mb-8">
          <% case @event.status %>
          <% when 'upcoming' %>
            <span class="px-6 py-3 bg-blue-500/20 text-blue-300 rounded-xl text-lg font-medium">
              <i class="fas fa-calendar-plus mr-2"></i>Événement à venir
            </span>
          <% when 'completed' %>
            <span class="px-6 py-3 bg-green-500/20 text-green-300 rounded-xl text-lg font-medium">
              <i class="fas fa-check-circle mr-2"></i>Événement terminé
            </span>
          <% when 'sold_out' %>
            <span class="px-6 py-3 bg-yellow-500/20 text-yellow-300 rounded-xl text-lg font-medium">
              <i class="fas fa-star mr-2"></i>Événement complet
            </span>
          <% when 'cancelled' %>
            <span class="px-6 py-3 bg-red-500/20 text-red-300 rounded-xl text-lg font-medium">
              <i class="fas fa-times-circle mr-2"></i>Événement annulé
            </span>
          <% end %>
        </div>
      </div>
    </div>
  </section>

  <!-- Edit Form Section -->
  <section class="edit-form py-8">
    <div class="container-app">
      <div class="glass-effect rounded-3xl p-6">
        <%= form_with model: [:admin, @event],
            class: "space-y-8",
            data: {
              controller: "admin-form",
              admin_form_auto_save_value: "true"
            } do |form| %>

          <!-- Error Messages -->
          <% if @event.errors.any? %>
            <div class="bg-red-500/10 border border-red-500/20 rounded-xl p-6 mb-8">
              <div class="flex items-center mb-4">
                <i class="fas fa-exclamation-triangle text-red-400 text-xl mr-3"></i>
                <h3 class="text-lg font-semibold text-red-400">
                  <%= pluralize(@event.errors.count, "erreur") %> empêche(nt) la sauvegarde :
                </h3>
              </div>
              <ul class="list-disc list-inside space-y-1">
                <% @event.errors.full_messages.each do |message| %>
                  <li class="text-red-300"><%= message %></li>
                <% end %>
              </ul>
            </div>
          <% end %>

          <!-- Basic Information Section -->
          <div class="form-section">
            <h3 class="text-2xl font-bold text-white mb-6 flex items-center">
              <i class="fas fa-info-circle text-primary mr-3"></i>
              Informations générales
            </h3>

            <div class="grid grid-cols-1 md:grid-cols-2 gap-6">
              <!-- Event Title -->
              <div class="form-group">
                <%= form.label :title, "Titre de l'événement", class: "form-label" %>
                <%= form.text_field :title,
                    class: "form-input",
                    placeholder: "Ex: Soirée cinéma spéciale",
                    required: true %>
              </div>

              <!-- Movie Selection -->
              <div class="form-group">
                <%= form.label :movie_id, "Film projeté", class: "form-label" %>
                <%= form.select :movie_id,
                    options_from_collection_for_select(@movies, :id, :title, @event.movie_id),
                    { prompt: "Sélectionner un film..." },
                    { class: "form-input" } %>
              </div>

              <!-- Event Date -->
              <div class="form-group">
                <%= form.label :event_date, "Date de l'événement", class: "form-label" %>
                <%= form.date_field :event_date,
                    class: "form-input",
                    required: true %>
              </div>

              <!-- Start Time -->
              <div class="form-group">
                <%= form.label :start_time, "Heure de début", class: "form-label" %>
                <%= form.time_field :start_time,
                    class: "form-input",
                    required: true %>
              </div>

              <!-- Max Capacity -->
              <div class="form-group">
                <%= form.label :max_capacity, "Capacité maximale", class: "form-label" %>
                <%= form.number_field :max_capacity,
                    class: "form-input",
                    min: 1,
                    max: 1000,
                    required: true %>
                <div class="text-sm text-gray-400 mt-1">
                  Nombre maximum de places disponibles
                </div>
              </div>

              <!-- Price -->
              <div class="form-group">
                <%= form.label :price_cents, "Prix (en centimes)", class: "form-label" %>
                <div class="relative">
                  <%= form.number_field :price_cents,
                      class: "form-input pr-12",
                      min: 0,
                      step: 1,
                      placeholder: "Ex: 1500 pour 15€" %>
                  <div class="absolute inset-y-0 right-0 pr-3 flex items-center text-gray-400">
                    centimes
                  </div>
                </div>
                <div class="text-sm text-gray-400 mt-1">
                  Prix actuel : <%= number_to_currency(@event.price_cents / 100.0) %>
                </div>
              </div>
            </div>

            <!-- Description -->
            <div class="form-group mt-6">
              <%= form.label :description, "Description", class: "form-label" %>
              <%= form.text_area :description,
                  class: "form-input",
                  rows: 4,
                  placeholder: "Description détaillée de l'événement..." %>
            </div>
          </div>

          <!-- Venue Information Section -->
          <div class="form-section">
            <h3 class="text-2xl font-bold text-white mb-6 flex items-center">
              <i class="fas fa-map-marker-alt text-primary mr-3"></i>
              Lieu de l'événement
            </h3>

            <div class="grid grid-cols-1 md:grid-cols-2 gap-6">
              <!-- Venue Name -->
              <div class="form-group">
                <%= form.label :venue_name, "Nom du lieu", class: "form-label" %>
                <%= form.text_field :venue_name,
                    class: "form-input",
                    placeholder: "Ex: Cinéma Rex",
                    list: "venues-list" %>
                <datalist id="venues-list">
                  <% @venues.each do |venue| %>
                    <option value="<%= venue %>">
                  <% end %>
                </datalist>
              </div>

              <!-- Venue Address -->
              <div class="form-group">
                <%= form.label :venue_address, "Adresse complète", class: "form-label" %>
                <%= form.text_area :venue_address,
                    class: "form-input",
                    rows: 3,
                    placeholder: "Adresse complète du lieu..." %>
              </div>
            </div>
          </div>
